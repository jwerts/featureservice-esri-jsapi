define(["dojo/_base/declare","dojo/Evented","dojo/_base/array","dojo/_base/lang","esri/request","dojo/Deferred"],function(e,s,r,t,o,n){"use strict";return e([s],{constructor:function(e,s){t.mixin(this,s),this.url=e},applyEdits:function(e,s){function t(e){var s=[],t=[];r.forEach(e,function(e){var o={id:e.id,adds:[],updates:[],deletes:[]};r.forEach(e.addResults,function(s){s.success?o.adds.push(s.objectId):(s.error.id=e.id,t.push(s.error))}),r.forEach(e.updateResults,function(s){s.success?o.updates.push(s.objectId):(s.error.id=e.id,t.push(s.error))}),r.forEach(e.deleteResults,function(s){s.success?o.deletes.push(s.objectId):(s.error.id=e.id,t.push(s.error))}),s.push(o)}),t.length?l.reject({message:"At least one layer's edits failed.",status:200,errors:t}):l.resolve(s)}function d(e){console.log(e),l.reject(e)}s="undefined"==typeof s?null:s;var u=[];r.forEach(e,function(e){var s={id:e.id};s.adds=r.map(e.adds,function(e){return e.toJson()}),s.updates=r.map(e.updates,function(e){return e.toJson()}),s.deletes=e.deletes||[],u.push(s)});var a={edits:JSON.stringify(u),rollbackOnFailure:!0,gdbVersion:s},i={url:this.url+"/applyEdits?f=json",content:a,handleAs:"json",useProxy:!1};console.log(i.url);var c=o(i,{usePost:!0}),l=new n;return c.then(t,d),l}})});