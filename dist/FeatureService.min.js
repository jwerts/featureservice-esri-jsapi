define(["dojo/_base/declare","dojo/Evented","dojo/_base/array","dojo/_base/lang","esri/request","dojo/Deferred"],function(e,s,t,n,o,r){"use strict";return e([s],{constructor:function(e,s){n.mixin(this,s),this.url=e},applyEdits:function(e,s){function n(e){function s(e,s,t){return null===e&&(e={}),e.hasOwnProperty(s)||(e[s]=[]),e[s].push(t),e}var n={},o=null;t.forEach(e,function(e){var r={adds:[],updates:[],deletes:[]};t.forEach(e.addResults,function(t){t.success?r.adds.push(t.objectId):o=s(o,e.id,t.error)}),t.forEach(e.updateResults,function(t){t.success?r.updates.push(t.objectId):o=s(o,e.id,t.error)}),t.forEach(e.deleteResults,function(t){t.success?r.deletes.push(t.objectId):o=s(o,e.id,t.error)}),n[e.id]=r}),null!==o?l.reject({message:"At least one layer's edits failed.",status:200,errors:o}):l.resolve(n)}function u(e){console.log(e),l.reject(e)}s="undefined"==typeof s?null:s;var d=[];t.forEach(e,function(e){var s={id:e.id};s.adds=t.map(e.adds,function(e){return e.toJson()}),s.updates=t.map(e.updates,function(e){return e.toJson()}),s.deletes=e.deletes||[],d.push(s)});var a={edits:JSON.stringify(d),rollbackOnFailure:!0,gdbVersion:s},c={url:this.url+"/applyEdits?f=json",content:a,handleAs:"json",useProxy:!1};console.log(c.url);var i=o(c,{usePost:!0}),l=new r;return i.then(n,u),l}})});